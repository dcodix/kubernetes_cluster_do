# kubernetes_cluster_do
It automatically creates a functional kubernetes cluster with basic services at Digital Ocean.

It also serves as a documentation of the kubernetes deployment process.

# LAUNCH
~~~~
./deploy_kubernetes_cluster.sh
~~~~
It should be executable.


# DELETE ALL
~~~~
terraform destroy
~~~~

# NOTES
## Certificates
I am attaching the autogenerated certificates with which I have been working with. Also the token.

Obviously those should change, that would imply:
1) at deploy_kubernetes_cluster.sh change the certificate names, if needed.
2) All variables for the template etc_kubernetes_kubeconfig.yaml.j2 will change. They live at the vault.
3) All the templates involving certificates or token contain variables, but those variables now will be different. They also live at the vault.

## Vault password
The current vault password is the really nice and secure "123456".
For this to work automatically file .vaultpass must exist and contain that really nice password.
The file lives at the project root.

## ENV variables needed
For this to work some variable must be set:
~~~~
export PATH_TO_CERTIFICATES=<path to certificates to be used>
export K8S_AUTH_TOKEN=<pregenerated auth token> (it is the same token as in the ansible variable vault_server_known_token_line_kubelet)
~~~~
Additionally if automatic kubectl auth setup is desidered
~~~~
export SETUP_KUBECTL=1
~~~~

The number of nodes to launch:
~~~~
NUMBER_OF_NODES defaults to 1 .
~~~~

## Master IP
Having a DNS is cool but it is good to remember that certificates depend on the name.
Not having a DNS implies 2 things:
1) The certificates suplied here can be used as they are.
2) /etc/hosts (or local DNS) must have the entry for the kubernetes-master pointing to the master public IP.

## ssh key
Terraform is going to install the given ssh key. Make sure to specify the correct one at ssh_key.tf

# TODO
Too much! It would be nice to automate more parts(like certificate and token creation). Also it would be great to reuse a lot of reusable parts in the ansible roles.

Anyway, it serves its purposes which are:
1) To document kubernetes deployment
2) To be able to launch and destroy the cluster to test apps.